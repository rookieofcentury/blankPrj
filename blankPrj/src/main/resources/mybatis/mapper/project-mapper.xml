<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="projectMapper">

	<resultMap type="HashMap" id="cateName">
		<id column="name" property="name" />
	</resultMap> 
	
	<select id="selectCategory" resultType="HashMap" resultMap="cateName">
		SELECT NO,NAME
		FROM PRJ_CATEGORY
	</select>
	
	<select id="selectPrj" resultType="ProjectVo">
		SELECT 
        P.NO
        ,P.TITLE
        ,P.PRICE
        ,P.START_DATE
        ,P.END_DATE
        ,P.TIME
        ,P.URL
        ,P.STATUS
        ,M.NICK CREATOR
         ,P.SUMMARY
        ,C.NAME AS CATEGORY
        ,(SELECT COUNT(R.NO) FROM REVIEW R INNER JOIN PROJECT P ON P.NO = R.PROJECT WHERE P.NO = 1) AS REVIEW
        ,(SELECT COUNT(N.NO) FROM NEWS N INNER JOIN PROJECT P ON P.NO = N.PRJ WHERE P.NO = 1) AS NEWS
		FROM PROJECT P
		INNER JOIN MEMBER M ON P.CREATOR = M.NO
		INNER JOIN PRJ_CATEGORY C ON P.CATEGORY = C.NO
		WHERE P.NO = #{p}
		GROUP BY P.NO ,P.TITLE ,P.PRICE ,P.START_DATE  ,P.END_DATE ,P.TIME ,P.URL ,P.STATUS, M.NICK, P.SUMMARY ,C.NAME
	</select>
	
	<select id="selectTimeList" resultType="TimeVo">
		SELECT *
		FROM START_TIME
	</select>
	
	<select id="selectMyPrj" resultType="ProjectVo">
		SELECT  
        	NO
        	,TITLE
        	,URL
        	,STATUS
        	,SUMMARY
		FROM PROJECT 
		WHERE CREATOR = 1
	</select>
	
	<select id="selectStatusAll" resultType="ProjectVo">
		SELECT  
		    COUNT(DISTINCT STATUS)
		FROM PROJECT 
		WHERE CREATOR = 1
	</select>
	
	<delete id="deletePrj">
		DELETE FROM PROJECT WHERE P.NO = 1
	</delete>
	
	<insert id="insertTempPrj">
	  	INSERT INTO PROJECT(
			NO
			, TITLE
			, CREATOR
			, PRICE)
			VALUES
			  	(
	        SEQ_PROJECT_NO.NEXTVAL,
	        #{title},
	        <!-- #{nick} --> 1,
	        #{price}
	  	)
  </insert>
  
</mapper>